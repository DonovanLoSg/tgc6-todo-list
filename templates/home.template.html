{%extends 'layout.template.html' %}

{%block title%}Todo List{%endblock%}

{%block content%}
<h2>Tasks</h2>

<form class="form-inline mb-3" method="GET">
    <input type="text" placeholder="Enter search terms" name="search-terms" class="form-control"/>
    <label class="ml-3">Task done?</label>
    <input type="radio" name="is_done" value="any" class="form-check-input ml-3"/>Any
    <input type="radio" name="is_done" value="done" class="form-check-input ml-3"/>Done
    <input type="radio" name="is_done" value="not-done" class="form-check-input ml-3"/>Not Done
        
    <input type="submit" value ="Search" class="ml-3 form-control"/>
</form>

<a href="{{url_for('create_task')}}" class="btn btn-primary">New Task</a>

<ul class="list-group mt-3">
{%for t in tasks %}
    <li class="list-group-item">
        {%if t.done %}
        <input type="checkbox" class="task-checkbox" data-task-id="{{t._id}}" checked/>
        {%else%}
        <input type="checkbox" class="task-checkbox" data-task-id="{{t._id}}"/>
        {%endif%}
        {{t.task_name}} 
    </li>
{%endfor%}

</ul>
{%endblock%}

{%block js%}
<script>
$(function(){
    $(".task-checkbox").change(function(){
        let task_id = $(this).data('task-id');
        // $.ajax({
        //     'url': "{{url_for('check_task')}}",
        //     'dataType': 'json',
        //     'contentType':'application/json',
        //     'data': JSON.stringify({
        //         'task_id': task_id
        //     }),
        //     'type':'PATCH'
        // })

        // alternative syntax using axios
        let url ="{{url_for('check_task')}}";
        let self = this;
        axios.patch(url, {
            'task_id':task_id
        }).then(function(){
            if (self.checked) {
                toastr.success("Item has been mark as done!");
            } else {
                toastr.success("item has been mark as not done!");
            }
            
        })
    })
})

</script>
{%endblock%}